<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI School - ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <link rel="stylesheet" href="index.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700&display=swap"
        rel="stylesheet">
    <style>
        .sim-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .status-panel {
            background: var(--color-surface);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            height: fit-content;
            border: 1px solid var(--color-border);
            position: sticky;
            top: 100px;
        }

        .metric-bar {
            height: 10px;
            background: #444;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
            margin-bottom: 15px;
        }

        .metric-fill {
            height: 100%;
            width: 50%;
            transition: width 0.5s ease, background-color 0.3s;
        }

        .game-area {
            background: var(--color-surface);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            text-align: center;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 1px solid var(--color-border);
            position: relative;
        }

        .scenario-card {
            animation: fadeIn 0.5s ease-out;
        }

        .choice-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        .choice-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--color-primary);
            transform: translateX(5px);
        }

        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .role-card {
            cursor: pointer;
            padding: 30px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-md);
            transition: all 0.3s;
        }

        .role-card:hover {
            border-color: var(--color-tertiary);
            transform: scale(1.05);
        }

        .tag {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 5px;
            background: #333;
        }
    </style>
</head>

<body>
    <header>
        <div class="container nav-content">
            <a href="index.html" class="logo">
                <img src="assets/ramen_icon.png" alt="Ramen Icon">
                <span>AI Ramen School</span>
            </a>
            <nav class="nav-links">
                <a href="index.html">ãƒ›ãƒ¼ãƒ  (Tips)</a>
                <a href="simulation.html" class="active">å­¦æ ¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</a>
                <a href="guide.html">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero" style="padding-top: var(--spacing-md); padding-bottom: var(--spacing-md);">
            <h1>School Governance Simulator</h1>
            <p>å­¦æ ¡å´ã¨è¡Œæ”¿å´ã€ãã‚Œãã‚Œã®ç«‹å ´ã‚’ä½“é¨“ã—ã¦ã€æœ€é©ãªAIå°å…¥ã‚’ç›®æŒ‡ã›ã€‚</p>
        </section>

        <div id="setup-view">
            <h2 class="text-center" style="margin-bottom: 30px;">ã‚ãªãŸã®ç«‹å ´ã‚’é¸ã‚“ã§ãã ã•ã„</h2>
            <div class="role-selector">
                <div class="role-card" onclick="startGame('school')">
                    <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ«</div>
                    <h3>ç¾å ´ã®æ•™å¸«</h3>
                    <p style="color: var(--color-text-muted); margin-top: 10px;">
                        ã€Œç›®ã®å‰ã®ç”Ÿå¾’ã®ãŸã‚ã«ã€ä¾¿åˆ©ãªé“å…·ã¯ã™ãã«ä½¿ã„ãŸã„ï¼ã€<br>
                        ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³é‡è¦–ã€ç¾å ´ã®åŠ¹ç‡åŒ–ãŒæœ€å„ªå…ˆã€‚
                    </p>
                </div>
                <div class="role-card" onclick="startGame('admin')">
                    <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ›ï¸</div>
                    <h3>æ•™è‚²å§”å“¡ä¼š (è¡Œæ”¿)</h3>
                    <p style="color: var(--color-text-muted); margin-top: 10px;">
                        ã€Œã‚‚ã—ä½•ã‹ã‚ã£ãŸã‚‰è²¬ä»»å•é¡Œã ã€‚æ…é‡ã«é€²ã‚ãªã‘ã‚Œã°...ã€<br>
                        å®‰å…¨æ€§ãƒ»å…¬å¹³æ€§é‡è¦–ã€ãƒªã‚¹ã‚¯å›é¿ãŒæœ€å„ªå…ˆã€‚
                    </p>
                </div>
            </div>
        </div>

        <div id="game-view" class="sim-container hidden">
            <!-- Status Panel -->
            <div class="status-panel">
                <h3 style="margin-bottom: 20px;">ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>

                <div>
                    <label>ğŸ’¡ ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³</label>
                    <div class="metric-bar">
                        <div class="metric-fill" id="bar-innovation"
                            style="background: var(--color-secondary); width: 50%;"></div>
                    </div>
                </div>

                <div>
                    <label>ğŸ›¡ï¸ å®‰å…¨æ€§ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</label>
                    <div class="metric-bar">
                        <div class="metric-fill" id="bar-safety" style="background: var(--color-primary); width: 50%;">
                        </div>
                    </div>
                </div>

                <div>
                    <label>ğŸ¤ ä¿è­·è€…ã®ä¿¡é ¼</label>
                    <div class="metric-bar">
                        <div class="metric-fill" id="bar-trust" style="background: var(--color-tertiary); width: 50%;">
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; font-size: 0.9rem; color: var(--color-text-muted);">
                    <p>â€» ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã«ãªã‚Šã¾ã™ã€‚</p>
                    <p id="turn-counter" style="margin-top: 10px; font-weight: bold; color: white;">æ®‹ã‚Šã‚¿ãƒ¼ãƒ³: 5</p>
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-area" id="scenario-area">
                <!-- Content injected by JS -->
            </div>
        </div>

        <div id="result-view" class="container hidden text-center" style="margin-top: 50px;">
            <h2 id="result-title">Title</h2>
            <p id="result-desc" style="font-size: 1.2rem; margin: 20px 0;">Desc</p>
            <button class="btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦éŠã¶</button>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        // Game State
        let state = {
            role: null,
            metrics: { innovation: 50, safety: 50, trust: 50 },
            turn: 0,
            maxTurns: 5,
            history: []
        };

        // Scenarios Database
        const scenarios = {
            school: [
                {
                    title: "ç”Ÿå¾’ãŒèª­æ›¸æ„Ÿæƒ³æ–‡ã«ChatGPTã‚’ä½¿ã„ãŸã„ã¨è¨€ã£ã¦ããŸ",
                    desc: "ã€Œå…ˆç”Ÿã€AIã‚’ä½¿ã£ã¦æ§‹æˆã‚’è€ƒãˆãŸã„ã‚“ã§ã™ãŒã€ã„ã„ã§ã™ã‹ï¼Ÿã€ã¨ç›¸è«‡ã•ã‚Œã¾ã—ãŸã€‚",
                    choices: [
                        {
                            text: "ã€Œã©ã‚“ã©ã‚“ä½¿ã„ãªã•ã„ï¼ã€ã¨å…¨é¢çš„ã«è¨±å¯ã™ã‚‹",
                            effect: { innovation: 20, safety: -10, trust: -10 },
                            feedback: "ç”Ÿå¾’ã¯å–œã³ã¾ã—ãŸãŒã€ä¸€éƒ¨ã®ä¿è­·è€…ã‹ã‚‰ã€Œè‡ªåˆ†ã§è€ƒãˆã•ã›ã¦ãªã„ã€ã¨ã‚¯ãƒ¬ãƒ¼ãƒ ãŒ..."
                        },
                        {
                            text: "ã€Œæ§‹æˆæ¡ˆã¾ã§ãªã‚‰OKã€ã¨æ¡ä»¶ä»˜ãã§è¨±å¯ã™ã‚‹",
                            effect: { innovation: 10, safety: 0, trust: 5 },
                            feedback: "è‰¯ã„ãƒãƒ©ãƒ³ã‚¹ã§ã™ï¼ç”Ÿå¾’ã‚‚ãƒ„ãƒ¼ãƒ«ã®é©åˆ‡ãªä½¿ã„æ–¹ã‚’å­¦ã³ã¾ã—ãŸã€‚"
                        },
                        {
                            text: "ã€Œè‡ªåˆ†ã®é ­ã§è€ƒãˆãªã•ã„ã€ã¨ç¦æ­¢ã™ã‚‹",
                            effect: { innovation: -15, safety: 10, trust: 5 },
                            feedback: "å®‰å…¨ã§ã™ãŒã€ç”Ÿå¾’ã®æ¢ç©¶å¿ƒã¯å°‘ã—å‰ŠãŒã‚Œã¦ã—ã¾ã£ãŸã‚ˆã†ã§ã™ã€‚"
                        }
                    ]
                },
                {
                    title: "æ–°ã—ã„ç”»åƒç”ŸæˆAIãƒ„ãƒ¼ãƒ«ãŒè©±é¡Œã§ã™",
                    desc: "ç¾è¡“ã®æˆæ¥­ã§ä½¿ãˆãã†ã§ã™ãŒã€è‘—ä½œæ¨©ã®ãƒ«ãƒ¼ãƒ«ãŒã¾ã æ›–æ˜§ã§ã™ã€‚",
                    choices: [
                        {
                            text: "æˆæ¥­ã§å¤§ã€…çš„ã«å°å…¥ã—ã¦å®Ÿé¨“ã™ã‚‹",
                            effect: { innovation: 25, safety: -20, trust: -5 },
                            feedback: "é¢ç™½ã„ä½œå“ãŒã§ãã¾ã—ãŸãŒã€ç”Ÿæˆç”»åƒãŒæ—¢å­˜ä½œå“ã«ä¼¼ã¦ã„ã¦å•é¡Œã«ãªã‚Šãã†ã§ã™ã€‚"
                        },
                        {
                            text: "æ ¡é•·ã¨ç›¸è«‡ã—ã¦ã‹ã‚‰ã€å¸Œæœ›è€…ã®ã¿ã§ã‚¯ãƒ©ãƒ–æ´»å‹•ã§è©¦ã™",
                            effect: { innovation: 10, safety: 5, trust: 5 },
                            feedback: "ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ã‚¿ãƒ¼ãƒˆãŒè‰¯ã„çµæœã‚’ç”Ÿã¿ã¾ã—ãŸã€‚"
                        }
                    ]
                },
                {
                    title: "æ•™å‹™ã®äº‹å‹™ä½œæ¥­åŠ¹ç‡åŒ–",
                    desc: "æˆç¸¾è¡¨ã®ã‚³ãƒ¡ãƒ³ãƒˆä½œæˆã‚’AIã«æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã„ãŸã„ã¨ã„ã†å£°ãŒè·å“¡å®¤ã§ä¸ŠãŒã£ã¦ã„ã¾ã™ã€‚",
                    choices: [
                        {
                            text: "å€‹äººæƒ…å ±ã‚’ä¼ã›ãŸçŠ¶æ…‹ã§ä½¿ã†ãƒ«ãƒ¼ãƒ«ã‚’ä½œã£ã¦å°å…¥",
                            effect: { innovation: 15, safety: 10, trust: 0 },
                            feedback: "åŠ¹ç‡ãŒåŠ‡çš„ã«ä¸ŠãŒã‚Šã¾ã—ãŸï¼å…ˆç”ŸãŸã¡ã«ç¬‘é¡”ãŒæˆ»ã‚Šã¾ã—ãŸã€‚"
                        },
                        {
                            text: "å€‹äººæƒ…å ±ã®æ¼æ´©ãŒæ€–ã„ã®ã§ã€å…¨é¢çš„ã«ç¦æ­¢ã™ã‚‹",
                            effect: { innovation: -10, safety: 5, trust: -5 },
                            feedback: "å…ˆç”ŸãŸã¡ã¯ç–²å¼Šã—ãŸã¾ã¾ã§ã™..."
                        }
                    ]
                },
                {
                    title: "ä¿è­·è€…ä¼šã§ã®èª¬æ˜",
                    desc: "ä¿è­·è€…ã‹ã‚‰ã€ŒAIãªã‚“ã¦å­¦æ ¡ã§æ•™ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã‹ï¼Ÿã€ã¨è³ªå•ãŒå‡ºã¾ã—ãŸã€‚",
                    choices: [
                        {
                            text: "ã€Œã“ã‚Œã‹ã‚‰ã®æ™‚ä»£ã«å¿…é ˆã§ã™ï¼ã€ã¨å¼·ãä¸»å¼µã™ã‚‹",
                            effect: { innovation: 5, safety: 0, trust: -10 },
                            feedback: "å°‘ã—å¼·å¼•ã™ããŸã‹ã‚‚ï¼Ÿä¸å®‰ã‚’æ„Ÿã˜ã‚‹ä¿è­·è€…ã‚‚ã„ã¾ã™ã€‚"
                        },
                        {
                            text: "ãƒ¡ãƒªãƒƒãƒˆã¨ãƒªã‚¹ã‚¯ã‚’ä¸å¯§ã«èª¬æ˜ã—ã€å¯¾è©±ã™ã‚‹",
                            effect: { innovation: 5, safety: 5, trust: 20 },
                            feedback: "èª å®Ÿãªæ…‹åº¦ãŒä¿¡é ¼ã‚’å‹ã¡å–ã‚Šã¾ã—ãŸã€‚"
                        }
                    ]
                },
                {
                    title: "äºˆç®—ç”³è«‹",
                    desc: "æ¥å¹´åº¦ã®äºˆç®—ç”³è«‹ã§ã™ã€‚ä½•ã«ä¸€ç•ªäºˆç®—ã‚’ä½¿ã„ã¾ã™ã‹ï¼Ÿ",
                    choices: [
                        {
                            text: "æœ‰æ–™ç‰ˆAIãƒ„ãƒ¼ãƒ«ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è³¼å…¥",
                            effect: { innovation: 20, safety: 5, trust: 0 },
                            feedback: "æœ€æ–°æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼"
                        },
                        {
                            text: "æ•™å“¡å‘ã‘ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ä½œæˆ",
                            effect: { innovation: 0, safety: 20, trust: 10 },
                            feedback: "åœ°å‘³ã§ã™ãŒã€åœŸå°ãŒã—ã£ã‹ã‚Šã—ã¾ã—ãŸã€‚"
                        }
                    ]
                }
            ],
            admin: [
                {
                    title: "å…¨æ ¡å°å…¥ã®ææ¡ˆ",
                    desc: "ã‚ã‚‹å…ˆé€²çš„ãªå­¦æ ¡ã‹ã‚‰ã€Œå…¨æ ¡ç”Ÿå¾’ã«ç”ŸæˆAIã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é…ã‚ŠãŸã„ã€ã¨è¦æœ›ãŒæ¥ã¾ã—ãŸã€‚",
                    choices: [
                        {
                            text: "å³åº§ã«æ‰¿èªã™ã‚‹",
                            effect: { innovation: 25, safety: -25, trust: -10 },
                            feedback: "ç¾å ´ã¯ç››ã‚Šä¸ŠãŒã£ã¦ã„ã¾ã™ãŒã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã®ä¸å‚™ã§ãƒˆãƒ©ãƒ–ãƒ«ç™ºç”Ÿï¼"
                        },
                        {
                            text: "ãƒ¢ãƒ‡ãƒ«æ ¡ã¨ã—ã¦ãã®1æ ¡ã ã‘ã§è©¦é¨“å°å…¥ã™ã‚‹",
                            effect: { innovation: 15, safety: 0, trust: 5 },
                            feedback: "è³¢æ˜ãªåˆ¤æ–­ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’é›†ã‚ã¦ã‹ã‚‰ä»–æ ¡ã¸åºƒã’ã¾ã—ã‚‡ã†ã€‚"
                        },
                        {
                            text: "æ™‚æœŸå°šæ—©ã¨ã—ã¦å´ä¸‹ã™ã‚‹",
                            effect: { innovation: -20, safety: 20, trust: 5 },
                            feedback: "ç¾å ´ã®ã‚„ã‚‹æ°—ã‚’å‰Šã„ã§ã—ã¾ã£ãŸã‚ˆã†ã§ã™ã€‚"
                        }
                    ]
                },
                // Add more admin scenarios similarly... 
                // For brevity in this artifact, reusing similar logic but simpler for prototype
                {
                    title: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®ç­–å®š",
                    desc: "å›½ã®æŒ‡é‡ãŒå¤‰ã‚ã‚Šã¾ã—ãŸã€‚ã©ã†å¯¾å¿œã—ã¾ã™ã‹ï¼Ÿ",
                    choices: [
                        {
                            text: "ç¾å ´ã®å®Ÿæƒ…ã«åˆã‚ã›ã¦ã€æŸ”è»Ÿãªç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚‹",
                            effect: { innovation: 10, safety: -5, trust: 10 },
                            feedback: "ç¾å ´ã‹ã‚‰ã¯æ„Ÿè¬ã•ã‚Œã¾ã—ãŸãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ç©´ãŒãªã„ã‹å¿ƒé…ã§ã™ã€‚"
                        },
                        {
                            text: "å›½ã®æŒ‡é‡é€šã‚Šã€å³æ ¼ã«åˆ¶é™ã™ã‚‹",
                            effect: { innovation: -15, safety: 25, trust: 5 },
                            feedback: "å®‰å…¨ã§ã™ãŒã€ä½¿ã„ã«ãã„ã¨ä¸æº€ã®å£°ãŒä¸ŠãŒã£ã¦ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                {
                    title: "ãƒˆãƒ©ãƒ–ãƒ«ç™ºç”Ÿï¼",
                    desc: "ã‚ã‚‹ç”Ÿå¾’ãŒAIã§ä¸é©åˆ‡ãªç”»åƒã‚’ä½œæˆã—ãŸã¨ã„ã†å™‚ãŒæµã‚Œã¾ã—ãŸã€‚",
                    choices: [
                        {
                            text: "å…¨æ ¡ã®AIåˆ©ç”¨ã‚’ç›´ã¡ã«åœæ­¢ã•ã›ã‚‹",
                            effect: { innovation: -30, safety: 30, trust: 10 },
                            feedback: "ç´ æ—©ã„å¯¾å¿œã§ç‚ä¸Šã¯é˜²ãã¾ã—ãŸãŒã€å­¦ç¿’ã‚‚æ­¢ã¾ã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚"
                        },
                        {
                            text: "äº‹å®Ÿç¢ºèªã‚’è¡Œã„ã€ãƒªãƒ†ãƒ©ã‚·ãƒ¼æ•™è‚²ã®æ©Ÿä¼šã«ã™ã‚‹",
                            effect: { innovation: 5, safety: 5, trust: 15 },
                            feedback: "ãƒ”ãƒ³ãƒã‚’ãƒãƒ£ãƒ³ã‚¹ã«å¤‰ãˆã¾ã—ãŸã€‚æ•™è‚²çš„ãªå¯¾å¿œã§ã™ã€‚"
                        }
                    ]
                }
            ]
        };

        function startGame(role) {
            state.role = role;
            document.getElementById('setup-view').classList.add('hidden');
            document.getElementById('game-view').classList.remove('hidden');

            // Adjust max turns based on available scenarios
            state.maxTurns = role === 'admin' ? 3 : 5;

            renderScenario();
            updateStats();
        }

        function renderScenario() {
            if (state.turn >= state.maxTurns) {
                endGame();
                return;
            }

            const currentScenario = scenarios[state.role][state.turn];
            const area = document.getElementById('scenario-area');

            let choicesHtml = currentScenario.choices.map((c, idx) => `
                <button class="choice-btn" onclick="makeChoice(${idx})">
                    <strong style="font-size: 1.1rem; display:block; width:100%; margin-bottom:5px;">â–¶ ${c.text}</strong>
                </button>
            `).join('');

            area.innerHTML = `
                <div class="scenario-card animate-fade-in">
                    <span style="color: var(--color-tertiary); font-weight: bold; display: block; margin-bottom: 10px;">TURN ${state.turn + 1} / ${state.maxTurns}</span>
                    <h2 style="margin-bottom: 15px;">${currentScenario.title}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 30px; color: var(--color-text-muted);">${currentScenario.desc}</p>
                    <div style="display: flex; flex-direction: column; gap: 10px; max-width: 600px; margin: 0 auto;">
                        ${choicesHtml}
                    </div>
                </div>
            `;

            document.getElementById('turn-counter').innerText = `æ®‹ã‚Šã‚¿ãƒ¼ãƒ³: ${state.maxTurns - state.turn}`;
        }

        function makeChoice(choiceIdx) {
            const scenario = scenarios[state.role][state.turn];
            const choice = scenario.choices[choiceIdx];

            // Apply effects
            state.metrics.innovation = Math.max(0, Math.min(100, state.metrics.innovation + choice.effect.innovation));
            state.metrics.safety = Math.max(0, Math.min(100, state.metrics.safety + choice.effect.safety));
            state.metrics.trust = Math.max(0, Math.min(100, state.metrics.trust + choice.effect.trust));

            state.turn++;
            updateStats();

            // Show feedback
            const area = document.getElementById('scenario-area');
            area.innerHTML = `
                <div class="scenario-card animate-fade-in">
                    <h2 style="color: var(--color-secondary); margin-bottom: 20px;">çµæœ</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 30px;">${choice.feedback}</p>
                    <button class="btn" onclick="renderScenario()">æ¬¡ã¸é€²ã‚€</button>
                </div>
            `;

            checkGameOver();
        }

        function updateStats() {
            document.getElementById('bar-innovation').style.width = state.metrics.innovation + '%';
            document.getElementById('bar-safety').style.width = state.metrics.safety + '%';
            document.getElementById('bar-trust').style.width = state.metrics.trust + '%';
        }

        function checkGameOver() {
            if (state.metrics.innovation <= 0 || state.metrics.safety <= 0 || state.metrics.trust <= 0) {
                endGame(true);
            }
        }

        function endGame(isGameOver = false) {
            document.getElementById('game-view').classList.add('hidden');
            const resultView = document.getElementById('result-view');
            resultView.classList.remove('hidden');

            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');

            if (isGameOver) {
                title.innerText = "GAME OVER...";
                title.style.color = "var(--color-primary)";
                desc.innerText = "ãƒãƒ©ãƒ³ã‚¹ãŒå´©å£Šã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚å­¦æ ¡é‹å–¶ã«ã¯ã€Œé©æ–°ã€ã€Œå®‰å…¨ã€ã€Œä¿¡é ¼ã€å…¨ã¦ã®ãƒãƒ©ãƒ³ã‚¹ãŒå¿…è¦ã§ã™ã€‚";
            } else {
                title.innerText = "MISSION COMPLETED!";
                title.style.color = "var(--color-tertiary)";

                let score = state.metrics.innovation + state.metrics.safety + state.metrics.trust;
                let rank = "B";
                if (score > 250) rank = "S (ä¼èª¬ã®æ•™è‚²è€…)";
                else if (score > 200) rank = "A (ç´ æ™´ã‚‰ã—ã„é‹å–¶)";
                else if (score > 150) rank = "B (å®‰å®šã—ãŸé‹å–¶)";
                else rank = "C (ã¾ã ã¾ã ã“ã‚Œã‹ã‚‰)";

                desc.innerHTML = `ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼<br>æœ€çµ‚ã‚¹ã‚³ã‚¢ãƒ©ãƒ³ã‚¯: <strong>${rank}</strong><br><br>ã‚ãªãŸã®é¸æŠãŒã€ã“ã‚Œã‹ã‚‰ã®AIæ™‚ä»£ã®æ•™è‚²ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚`;
            }
        }
    </script>
</body>

</html>